<!-- Login Modal -->
<div class="modal fade" [class.show]="showModal" [class.d-block]="showModal" tabindex="-1" role="dialog" (click)="onBackdropClick($event)" [style.display]="showModal ? 'block' : 'none'">
  <!-- Backdrop first so dialog renders on top -->
  <div class="modal-backdrop fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" (click)="closeModal()"></div>
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content login-modal-content">
      <div class="modal-header login-modal-header">
        <button type="button" class="btn-close btn-close-white login-close-btn" (click)="closeModal()" aria-label="Close"></button>
        <h5 class="modal-title login-title">
          {{ showLoginTab ? "התחברות לדוג'ו" : "הרשמה לדוג'ו" }}
        </h5>
      </div>
      <div class="modal-body login-modal-body">
        @if (showLoginTab) {
          <p class="login-subtitle">היכנסו לחשבון שלכם כדי לגשת לאימונים ומשאבי הנינג'וטסו</p>
        }

        <!-- Tabs -->
        @if (showLoginTab) {
          <div class="login-tabs">
            <button
              type="button"
              class="tab-button"
              [class.active]="activeTab === 'login'"
              (click)="setActiveTab('login')">
              התחברות
            </button>
            <button
              type="button"
              class="tab-button"
              [class.active]="activeTab === 'register'"
              (click)="setActiveTab('register')">
              הרשמה
            </button>
          </div>
        }

        <!-- Login Form -->
        @if (showLoginTab && activeTab === 'login') {
          <div class="login-content">
            <form [formGroup]="loginForm" (ngSubmit)="onLogin()" class="login-form">
              <!-- Username/Email Field -->
              <div class="form-group">
                <label for="username" class="form-label">שם משתמש או אימייל</label>
                <div class="input-wrapper">
                  <input
                    id="username"
                    type="text"
                    formControlName="username"
                    class="form-input"
                    [class.error]="username?.invalid && username?.touched"
                    placeholder="הזן שם משתמש או אימייל"
                    autocomplete="username"
                    required>
                  </div>
                  @if (username?.invalid && username?.touched) {
                    <div class="error-message">
                      @if (username?.errors?.['required']) {
                        <span>שם משתמש נדרש</span>
                      }
                    </div>
                  }
                </div>
                <!-- Password Field -->
                <div class="form-group">
                  <label for="password" class="form-label">סיסמה</label>
                  <div class="input-wrapper">
                    <input
                      id="password"
                      type="password"
                      formControlName="password"
                      class="form-input"
                      [class.error]="password?.invalid && password?.touched"
                      placeholder="הזן סיסמה"
                      autocomplete="current-password"
                      required>
                    </div>
                    @if (password?.invalid && password?.touched) {
                      <div class="error-message">
                        @if (password?.errors?.['required']) {
                          <span>סיסמה נדרשת</span>
                        }
                        @if (password?.errors?.['minlength']) {
                          <span>סיסמה חייבת להיות לפחות 6 תווים</span>
                        }
                      </div>
                    }
                  </div>
                  <!-- Error Message -->
                  @if (errorMessage) {
                    <div class="alert-error">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                      </svg>
                      <span>{{ errorMessage }}</span>
                    </div>
                  }
                  <!-- Submit Button -->
                  <button
                    type="submit"
                    class="submit-button"
                    [disabled]="isLoginLoading || loginForm.invalid">
                    @if (!isLoginLoading) {
                      <span>התחבר</span>
                    }
                    @if (isLoginLoading) {
                      <span>מתחבר...</span>
                    }
                  </button>
                </form>
              </div>
            }

            <!-- Register Form -->
            @if (activeTab === 'register') {
              <app-registration-form
                [showLoginTab]="showLoginTab"
                (switchToLoginTab)="onSwitchToLoginTab($event)">
              </app-registration-form>
            }
      </div>
    </div>
  </div>
</div>
