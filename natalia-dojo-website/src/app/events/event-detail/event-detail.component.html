<!-- Registration Dialog -->
<app-registration-dialog></app-registration-dialog>

<app-event-detail-hero 
  [eventTitle]="event?.title || null" 
  [eventDescription]="event?.description || null"
  [eventType]="event?.eventType || null"
  [startDateTime]="event?.startDateTime || null"
  [price]="event?.price || 0"
  [earlyBirdPrice]="event?.earlyBirdPrice || null"
  [earlyBirdDeadline]="event?.earlyBirdDeadline || null">
</app-event-detail-hero>

<div class="container-fluid px-2 px-md-5 py-2 py-md-5" dir="rtl" style="overflow-x: hidden; max-width: 100vw; width: 100%;">
  <div class="row g-5" style="margin: 0;">
    <div class="col-12" style="padding: 0;">
      <div class="event-detail-content">
        <!-- Loading State -->
        <div class="text-center py-5" *ngIf="isLoading">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">טוען...</span>
          </div>
        </div>

        <!-- Error State -->
        <div class="alert alert-danger" *ngIf="errorMessage && !isLoading">
          {{ errorMessage }}
        </div>

        <!-- Success Message -->
        <div class="alert alert-success" *ngIf="successMessage">
          {{ successMessage }}
        </div>

        <!-- Event Details -->
        <div class="event-detail-card" *ngIf="event && !isLoading">
          <!-- Event Image -->
          <div class="event-detail-image" *ngIf="event.imageUrl && displayImageUrl && isBrowser">
            <img [src]="displayImageUrl" [alt]="event.title || 'Event'" loading="lazy" 
                 (error)="onImageError($event)" 
                 (load)="onImageLoad($event)">
          </div>

          <!-- Event Header -->
          <div class="event-detail-header">
            <div class="event-detail-badges">
              <span class="badge bg-primary text-uppercase">{{ event.eventType || 'סמינר' }}</span>
              <span class="badge bg-secondary" *ngIf="!event.isPublished">טיוטה</span>
            </div>
            <h1 class="event-detail-title">{{ event.title || 'סמינר' }}</h1>
          </div>

          <!-- Event Body -->
          <div class="event-detail-body">
            <!-- Description -->
            <div class="event-detail-section" *ngIf="event.description">
              <h3 class="section-title">תיאור</h3>
              <div class="section-content" [innerHTML]="getDescriptionHtml(event.description)"></div>
            </div>

            <!-- Event Details Grid -->
            <div class="event-details-grid">
              <div class="detail-item">
                <i class="bi bi-calendar-event"></i>
                <div class="detail-content">
                  <strong>תאריך התחלה:</strong>
                  <div>{{ event.startDateTime | date:'dd/MM/yyyy' }}</div>
                </div>
              </div>

              <div class="detail-item">
                <i class="bi bi-calendar-check"></i>
                <div class="detail-content">
                  <strong>תאריך סיום:</strong>
                  <div>{{ event.endDateTime | date:'dd/MM/yyyy' }}</div>
                </div>
              </div>

              <div class="detail-item">
                <i class="bi bi-hourglass-split"></i>
                <div class="detail-content">
                  <strong>משך האירוע:</strong>
                  <div>{{ getEventDuration() }} שעות</div>
                </div>
              </div>

              <div class="detail-item" *ngIf="event.location">
                <i class="bi bi-geo-alt"></i>
                <div class="detail-content">
                  <strong>מיקום:</strong>
                  <div>{{ event.location }}</div>
                  <a *ngIf="event.locationUrl" [href]="event.locationUrl" target="_blank" rel="noopener" class="text-primary mt-1 d-inline-block">
                    <i class="bi bi-map"></i> פתח במפה
                  </a>
                </div>
              </div>

              <div class="detail-item">
                <i class="bi bi-info-circle"></i>
                <div class="detail-content">
                  <strong>סטטוס הרשמה:</strong>
                  <div>
                    <span class="badge" [class.bg-success]="event.registrationOpen" [class.bg-secondary]="!event.registrationOpen">
                      {{ event.registrationOpen ? 'פתוח להרשמה' : 'הרשמה סגורה' }}
                    </span>
                  </div>
                </div>
              </div>

              <div class="detail-item" *ngIf="event.registrationDeadline">
                <i class="bi bi-clock"></i>
                <div class="detail-content">
                  <strong>דדליין הרשמה:</strong>
                  <div>{{ event.registrationDeadline | date:'dd/MM/yyyy HH:mm' }}</div>
                </div>
              </div>

              <div class="detail-item">
                <i class="bi bi-currency-exchange"></i>
                <div class="detail-content">
                  <strong>מחיר רגיל:</strong>
                  <div class="fs-5 fw-bold text-primary">{{ event.price | currency:'ILS':'symbol':'1.0-0' }}</div>
                </div>
              </div>

              <div class="detail-item" *ngIf="event.earlyBirdPrice">
                <i class="bi bi-tag-fill"></i>
                <div class="detail-content">
                  <strong>מחיר הרשמה מוקדמת:</strong>
                  <div class="fs-5 fw-bold text-success">{{ event.earlyBirdPrice | currency:'ILS':'symbol':'1.0-0' }}</div>
                  <div *ngIf="event.earlyBirdDeadline" class="mt-1">
                    <span class="badge" [class.bg-success]="isEarlyBirdAvailable()" [class.bg-secondary]="!isEarlyBirdAvailable()">
                      {{ isEarlyBirdAvailable() ? 'זמין עד' : 'פג תוקף' }} {{ event.earlyBirdDeadline | date:'dd/MM/yyyy' }}
                    </span>
                  </div>
                </div>
              </div>

              <div class="detail-item" *ngIf="event.maxAttendees">
                <i class="bi bi-people"></i>
                <div class="detail-content">
                  <strong>מספר משתתפים מקסימלי:</strong>
                  <div>{{ event.maxAttendees }} משתתפים</div>
                </div>
              </div>
            </div>

            <!-- Enroll Button -->
            <div class="event-detail-actions">
              <button
                type="button"
                class="btn btn-primary btn-lg w-100"
                [disabled]="!event.registrationOpen"
                (click)="enroll()">
                <span *ngIf="event.registrationOpen && isAuthenticated">
                  <i class="bi bi-check-circle me-2"></i>
                  הירשם לסמינר
                </span>
                <span *ngIf="event.registrationOpen && !isAuthenticated">
                  <i class="bi bi-box-arrow-in-right me-2"></i>
                  התחבר/י כדי להירשם
                </span>
                <span *ngIf="!event.registrationOpen">
                  <i class="bi bi-x-circle me-2"></i>
                  ההרשמה סגורה
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
