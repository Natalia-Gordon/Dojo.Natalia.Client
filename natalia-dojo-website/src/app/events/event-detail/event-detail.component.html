<!-- Registration Dialog -->
<app-event-registration-dialog></app-event-registration-dialog>

<app-event-detail-hero
  [eventTitle]="event?.title || null"
  [eventDescription]="event?.description || null"
  [eventType]="event?.eventType || null"
  [startDateTime]="event?.startDateTime || null"
  [price]="event?.price || 0"
  [earlyBirdPrice]="event?.earlyBirdPrice || null"
  [earlyBirdDeadline]="event?.earlyBirdDeadline || null"
  [fromEventsManagement]="fromEventsManagement"
  [fromMyEvents]="fromMyEvents">
</app-event-detail-hero>

<div class="container-fluid px-2 px-md-5 py-2 py-md-5" dir="rtl" style="overflow-x: hidden; max-width: 100vw; width: 100%;">
  <div class="row g-5" style="margin: 0;">
    <div class="col-12" style="padding: 0;">
      <div class="event-detail-content">
        <!-- Loading State -->
        <div *ngIf="isLoading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">טוען...</span>
          </div>
        </div>

        <!-- Error State -->
        <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
          {{ errorMessage }}
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="alert alert-success">
          {{ successMessage }}
        </div>

        <!-- Event Details -->
        <ng-container *ngIf="event && !isLoading">
          <div class="event-detail-card">
            <!-- Event Image -->
            <div *ngIf="event.imageUrl && displayImageUrl && isBrowser" class="event-detail-image">
              <img [src]="displayImageUrl" [alt]="event.title || 'Event'" loading="eager"
                (error)="onImageError($event)"
                (load)="onImageLoad($event)">
            </div>
            <!-- Event Header -->
            <div class="event-detail-header">
              <div class="event-detail-badges">
                <span class="badge bg-primary text-uppercase">{{ event.eventType || 'סמינר' }}</span>
                <span *ngIf="!event.isPublished" class="badge bg-secondary">טיוטה</span>
              </div>
              <h1 class="event-detail-title">{{ event.title || 'סמינר' }}</h1>
            </div>
            <!-- Event Body -->
            <div class="event-detail-body">
              <!-- Description -->
              <div *ngIf="event.description" class="event-detail-section">
                <h3 class="section-title">תיאור</h3>
                <div class="section-content" [innerHTML]="getDescriptionHtml(event.description)"></div>
              </div>
              <!-- Event Details Grid -->
              <div class="event-details-grid">
                <div *ngIf="instructorName" class="detail-item">
                  <i class="bi bi-person-badge"></i>
                  <div class="detail-content">
                    <strong>מדריך/ה:</strong>
                    <div>{{ instructorName }}</div>
                  </div>
                </div>
                <div class="detail-item">
                  <i class="bi bi-calendar-event"></i>
                  <div class="detail-content">
                    <strong>תאריך התחלה:</strong>
                    <div>{{ event.startDateTime | date:'dd/MM/yyyy' }}</div>
                  </div>
                </div>
                <div class="detail-item">
                  <i class="bi bi-calendar-check"></i>
                  <div class="detail-content">
                    <strong>תאריך סיום:</strong>
                    <div>{{ event.endDateTime | date:'dd/MM/yyyy' }}</div>
                  </div>
                </div>
                <div class="detail-item">
                  <i class="bi bi-hourglass-split"></i>
                  <div class="detail-content">
                    <strong>משך האירוע:</strong>
                    <div>{{ getEventDuration() }} שעות</div>
                  </div>
                </div>
                <div *ngIf="event.location" class="detail-item">
                  <i class="bi bi-geo-alt"></i>
                  <div class="detail-content">
                    <strong>מיקום:</strong>
                    <div>{{ event.location }}</div>
                    <a *ngIf="event.locationUrl" [href]="event.locationUrl" target="_blank" rel="noopener" class="text-primary mt-1 d-inline-block">
                      <i class="bi bi-map"></i> פתח במפה
                    </a>
                  </div>
                </div>
                <div class="detail-item">
                  <i class="bi bi-info-circle"></i>
                  <div class="detail-content">
                    <strong>סטטוס הרשמה:</strong>
                    <div>
                      <span class="badge" [class.bg-success]="event.registrationOpen" [class.bg-secondary]="!event.registrationOpen">
                        {{ getRegistrationStatusLabel() }}
                      </span>
                    </div>
                  </div>
                </div>
                <div *ngIf="event.registrationDeadline" class="detail-item">
                  <i class="bi bi-clock"></i>
                  <div class="detail-content">
                    <strong>דדליין הרשמה:</strong>
                    <div>{{ getFormattedRegistrationDeadline() }}</div>
                  </div>
                </div>
                <div class="detail-item">
                  <i class="bi bi-currency-exchange"></i>
                  <div class="detail-content">
                    <strong>מחיר רגיל:</strong>
                    <div class="fs-5 fw-bold text-primary">{{ getFormattedPrice(event.price) }}</div>
                  </div>
                </div>
                <div *ngIf="event.earlyBirdPrice" class="detail-item">
                  <i class="bi bi-tag-fill"></i>
                  <div class="detail-content">
                    <strong>מחיר הרשמה מוקדמת:</strong>
                    <div class="fs-5 fw-bold text-success">{{ getFormattedPrice(event.earlyBirdPrice) }}</div>
                    <div *ngIf="event.earlyBirdDeadline" class="mt-1">
                      <span class="badge" [class.bg-success]="isEarlyBirdAvailable()" [class.bg-secondary]="!isEarlyBirdAvailable()">
                        {{ getEarlyBirdDeadlineLabel() }} {{ event.earlyBirdDeadline | date:'dd/MM/yyyy' }}
                      </span>
                    </div>
                  </div>
                </div>
                <div *ngIf="event.maxAttendees" class="detail-item">
                  <i class="bi bi-people"></i>
                  <div class="detail-content">
                    <strong>מספר משתתפים מקסימלי:</strong>
                    <div>{{ event.maxAttendees }} משתתפים</div>
                  </div>
                </div>
              </div>
              <!-- Enroll Button -->
              <div class="event-detail-actions">
                <button
                  type="button"
                  class="btn btn-primary btn-lg w-100"
                  [disabled]="!event.registrationOpen"
                  (click)="enroll()">
                  <span *ngIf="event.registrationOpen && isAuthenticated">
                    <i class="bi bi-check-circle me-2"></i>
                    הירשם לסמינר
                  </span>
                  <span *ngIf="event.registrationOpen && !isAuthenticated">
                    <i class="bi bi-box-arrow-in-right me-2"></i>
                    התחבר/י כדי להירשם
                  </span>
                  <span *ngIf="!event.registrationOpen">
                    <i class="bi bi-x-circle me-2"></i>
                    ההרשמה סגורה
                  </span>
                </button>
              </div>
            </div>
          </div>
        </ng-container>
        </div>
      </div>
    </div>
  </div>
