<app-events-hero></app-events-hero>
<div class="container-fluid px-2 px-md-5 py-2 py-md-5" style="overflow-x: hidden; max-width: 100vw; width: 100%;">
  <div class="row g-5" style="margin: 0;">
    <div class="col-12" dir="rtl" style="padding: 0;">
      <div class="events-content-card">
        <div class="alert alert-danger alert-dismissible fade show" *ngIf="errorMessage" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{ errorMessage }}
          <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="סגור"></button>
        </div>
        <div class="alert alert-success alert-dismissible fade show" *ngIf="successMessage" role="alert">
          <i class="bi bi-check-circle-fill me-2"></i>
          {{ successMessage }}
          <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="סגור"></button>
        </div>

        <div class="loading-state" *ngIf="isLoading">
          <div class="loading-spinner">
            <div class="spinner-border text-danger" role="status">
              <span class="visually-hidden">טוען...</span>
            </div>
          </div>
          <p class="loading-text">טוען סמינרים...</p>
        </div>

        <div class="empty-state" *ngIf="!isLoading && events.length === 0 && !errorMessage">
          <div class="empty-state__icon">
            <i class="bi bi-calendar-x"></i>
          </div>
          <h3 class="empty-state__title">אין סמינרים זמינים כרגע</h3>
          <p class="empty-state__text">כרגע אין סמינרים פתוחים להרשמה, חזרו אלינו בקרוב.</p>
          <button class="btn btn-outline-primary mt-3" (click)="loadEvents()" *ngIf="errorMessage">
            <i class="bi bi-arrow-clockwise me-2"></i>
            נסה שוב
          </button>
        </div>

        <div class="events-list" *ngIf="!isLoading && events.length > 0">
          <div class="event-card" *ngFor="let eventItem of events; trackBy: trackByEventId" [attr.aria-label]="'סמינר: ' + (eventItem.title || 'סמינר')">
            <div class="event-card__header">

              <h3 class="event-card__title">{{ eventItem.title || 'סמינר' }}</h3>
              <div class="event-card__status" [class.status-open]="eventItem.registrationOpen" [class.status-closed]="!eventItem.registrationOpen">
                <i class="bi" [class.bi-check-circle]="eventItem.registrationOpen" [class.bi-x-circle]="!eventItem.registrationOpen"></i>
                <span>{{ eventItem.registrationOpen ? 'פתוח להרשמה' : 'הרשמה סגורה' }}</span>
              </div>
            </div>
            <div class="event-card__body">
              <p class="event-card__description" *ngIf="eventItem.description">{{ eventItem.description }}</p>
              <div class="event-card__meta">
                <div class="event-meta-item">
                  <i class="bi bi-calendar3"></i>
                  <span>{{ eventItem.startDateTime | date:'dd/MM/yyyy' }} - {{ eventItem.endDateTime | date:'dd/MM/yyyy' }}</span>
                </div>
              </div>
            </div>
            <div class="event-card__footer">
              <a [routerLink]="['/events', eventItem.id]" class="event-card__button">
                <i class="bi bi-arrow-left"></i>
                <span>תצוגה מקדימה</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="admin-section" *ngIf="isAdminOrInstructor">
        <div class="admin-form-header">
          <div class="admin-form-header__content">
            <h3 class="admin-form-header__title">יצירת סמינר חדש</h3>
            <p class="admin-form-header__subtitle">בנו חוויה מקצועית למתאמנים – פרטים מדויקים, תמחור ברור, והרשמה פשוטה.</p>
          </div>
          <div class="admin-form-header__badge">
            <i class="bi bi-shield-check"></i>
            מנהל/מדריך
          </div>
        </div>

        <form [formGroup]="createForm" (ngSubmit)="submitCreate()" class="seminar-form">
          <div class="seminar-form__section">
            <h5 class="seminar-form__title">
              <i class="bi bi-journal-text me-2"></i>
              פרטי סמינר
            </h5>
            <div class="row g-4">
              <div class="col-md-6">
                <label class="form-label seminar-form__label">כותרת <span class="text-danger">*</span></label>
                <input class="form-control seminar-form__input" type="text" formControlName="title" placeholder="כותרת לסמינר" 
                       [class.is-invalid]="createForm.get('title')?.invalid && createForm.get('title')?.touched">
                <div class="invalid-feedback" *ngIf="createForm.get('title')?.invalid && createForm.get('title')?.touched">
                  כותרת נדרשת
                </div>
                <small class="seminar-form__hint">שם קצר וברור שמסביר את מטרת הסמינר.</small>
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">סוג אירוע</label>
                <select class="form-control seminar-form__input" formControlName="eventType">
                  <option value="Seminar">סמינר</option>
                  <option value="Workshop">סדנה</option>
                  <option value="Masterclass">כיתת אמן</option>
                  <option value="Grading">מבחן דרגה</option>
                  <option value="Retreat">ריטריט</option>
                  <option value="Special">אירוע מיוחד</option>
                </select>
                <small class="seminar-form__hint">בחר/י את סוג האירוע מתוך הרשימה.</small>
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">מדריך</label>
                <select class="form-control seminar-form__input" formControlName="instructorId" [disabled]="isLoadingInstructors">
                  <option value="">-- בחר/י מדריך --</option>
                  <option *ngFor="let instructor of instructors" [value]="instructor.instructorId">
                    {{ instructor.displayName || instructor.username || 'מדריך ' + instructor.instructorId }}
                  </option>
                </select>
                <small class="seminar-form__hint" *ngIf="!isLoadingInstructors">
                  בחר/י מדריך לאירוע (אופציונלי)
                </small>
                <small class="seminar-form__hint text-muted" *ngIf="isLoadingInstructors">
                  <span class="spinner-border spinner-border-sm me-1"></span>
                  טוען מדריכים...
                </small>
              </div>
              <div class="col-12">
                <label class="form-label seminar-form__label">תיאור</label>
                <textarea class="form-control seminar-form__input" rows="3" formControlName="description" placeholder="תיאור קצר"></textarea>
                <small class="seminar-form__hint">ספרו למשתתפים למה הסמינר מיועד ולמי הוא מתאים.</small>
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">תאריך התחלה</label>
                <input class="form-control seminar-form__input" type="datetime-local" formControlName="startDateTime">
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">תאריך סיום</label>
                <input class="form-control seminar-form__input" type="datetime-local" formControlName="endDateTime">
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">מיקום</label>
                <input class="form-control seminar-form__input" type="text" formControlName="location">
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">קישור למיקום</label>
                <input class="form-control seminar-form__input" type="url" formControlName="locationUrl" placeholder="https://maps.google.com/..." (click)="openGoogleMapsIfEmpty()">
                <small class="seminar-form__hint">הדבק/י קישור למיקום מ-Google Maps.</small>
              </div>
              <div class="col-12">
                <label class="form-label seminar-form__label">קישור לתמונה</label>
                <input class="form-control seminar-form__input" type="url" formControlName="imageUrl" placeholder="https://drive.google.com/...">
                <small class="seminar-form__hint">
                  <strong>איך לטעון תמונה מ-Google Drive:</strong><br>
                  1. העלה את התמונה ל-Google Drive<br>
                  2. לחץ לחיצה ימנית על הקובץ → "קבל קישור" → "כל מי שיש לו את הקישור" → "העתק קישור"<br>
                  3. הדבק את הקישור כאן (ההמרה תתבצע אוטומטית)
                </small>
              </div>
            </div>
          </div>

          <div class="seminar-form__section">
            <h5 class="seminar-form__title">
              <i class="bi bi-cash-stack me-2"></i>
              תמחור והרשמה
            </h5>
            <div class="row g-4">
              <div class="col-md-4">
                <label class="form-label seminar-form__label">כמות משתתפים</label>
                <input class="form-control seminar-form__input" type="number" formControlName="maxAttendees" min="0">
                <small class="seminar-form__hint">השאירו ריק אם אין הגבלה.</small>
              </div>
              <div class="col-md-4">
                <label class="form-label seminar-form__label">מחיר <span class="text-danger">*</span></label>
                <input class="form-control seminar-form__input" type="number" formControlName="price" min="0" step="1"
                       [class.is-invalid]="createForm.get('price')?.invalid && createForm.get('price')?.touched">
                <div class="invalid-feedback" *ngIf="createForm.get('price')?.invalid && createForm.get('price')?.touched">
                  מחיר נדרש וחייב להיות 0 או יותר
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label seminar-form__label">מחיר הרשמה מוקדמת</label>
                <input class="form-control seminar-form__input" type="number" formControlName="earlyBirdPrice" min="0" step="1">
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">תאריך יעד להרשמה מוקדמת</label>
                <input class="form-control seminar-form__input" type="date" formControlName="earlyBirdDeadline">
              </div>
              <div class="col-md-6">
                <label class="form-label seminar-form__label">דדליין הרשמה</label>
                <input class="form-control seminar-form__input" type="datetime-local" formControlName="registrationDeadline">
              </div>
            </div>
          </div>

          <div class="seminar-form__section">
            <h5 class="seminar-form__title">
              <i class="bi bi-gear me-2"></i>
              הגדרות נוספות
            </h5>
            <div class="row g-4 align-items-center">
              <div class="col-md-6">
                <div class="form-check seminar-form__check">
                  <input class="form-check-input" type="checkbox" formControlName="registrationOpen" id="registrationOpen">
                  <label class="form-check-label" for="registrationOpen">פתוח להרשמה</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check seminar-form__check">
                  <input class="form-check-input" type="checkbox" formControlName="isPublished" id="isPublished">
                  <label class="form-check-label" for="isPublished">פרסום מיידי</label>
                </div>
              </div>
            </div>
          </div>

          <div class="seminar-form__actions">
            <button class="btn btn-danger px-5 py-3" type="submit" [disabled]="isCreating || createForm.invalid" 
                    [attr.aria-busy]="isCreating">
              <span *ngIf="isCreating" class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
              <i *ngIf="!isCreating" class="bi bi-check-lg me-2"></i>
              <span *ngIf="!isCreating">צור סמינר</span>
              <span *ngIf="isCreating">שומר...</span>
            </button>
            <button type="button" class="btn btn-outline-secondary px-4 py-3 ms-2" (click)="createForm.reset(); createForm.patchValue({eventType: 'Seminar', registrationOpen: true, isPublished: true, price: 0})" [disabled]="isCreating">
              <i class="bi bi-arrow-counterclockwise me-2"></i>
              איפוס
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
