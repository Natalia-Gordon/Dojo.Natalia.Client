<nav class="navbar navbar-expand-lg bg-dark navbar-dark p-3 p-lg-0 px-lg-0">
  <!-- Mobile Layout: Logo in center, hamburger on right -->
  <div class="d-flex d-lg-none w-100 justify-content-between align-items-center">
    <div class="flex-grow-1 d-flex justify-content-center order-2">
      <a href="#" class="navbar-brand m-0">
        <img src="/assets/img/logo.svg" alt="Dojo Natalia">
      </a>
    </div>
    <button type="button" class="navbar-toggler order-1" (click)="toggleMobileMenu()" [attr.aria-expanded]="isMobileMenuOpen" aria-controls="navbarCollapse">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>

  <div class="collapse navbar-collapse" [class.show]="isMobileMenuOpen" id="navbarCollapse">
    <!-- Mobile: User Info Section (only when authenticated) -->
    @if (isAuthenticated && userInfo && isBrowser) {
      <div class="mobile-user-section d-lg-none">
        <div class="mobile-user-header">
          <button
            type="button"
            class="mobile-user-avatar"
            (click)="openUserDetails(); closeMobileMenu()"
            title="פרטי משתמש">
            <span class="mobile-avatar-initial">{{ getUserInitials() }}</span>
          </button>
          <div class="mobile-user-details">
            <div class="mobile-user-name">{{ userInfo.displayName || userInfo.username }}</div>
            @if (userInfo.lastLoginAt) {
              <div class="mobile-user-last-login">
                {{ formatLastLogin(userInfo.lastLoginAt) }}
              </div>
            }
          </div>
        </div>
      </div>
    }

    <div class="navbar-nav py-0">
      <a routerLink="/home" routerLinkActive="active" class="nav-item nav-link" (click)="closeMobileMenu()">בית</a>
      <a routerLink="/about" routerLinkActive="active" class="nav-item nav-link" (click)="closeMobileMenu()">אודות</a>
      <a routerLink="/workouts" routerLinkActive="active" class="nav-item nav-link" (click)="closeMobileMenu()">יומן אימונים</a>
      <a routerLink="/events" routerLinkActive="active" class="nav-item nav-link" (click)="closeMobileMenu()">סמינרים</a>
      <a routerLink="/gallery" routerLinkActive="active" class="nav-item nav-link" (click)="closeMobileMenu()">גלריה</a>
      <div class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle" (click)="toggleDropdown($event)">בלוג</a>
        <div class="dropdown-menu">
          <a routerLink="/sensei/articles/zen" routerLinkActive="active" class="dropdown-item" (click)="closeMobileMenu()">פילוסופיה של זן</a>
        </div>
      </div>
      <a routerLink="/testimonial" routerLinkActive="active" class="nav-item nav-link" (click)="closeMobileMenu()">ממליצים</a>
      <a routerLink="/contact" routerLinkActive="active" class="nav-item nav-link" (click)="closeMobileMenu()">צור קשר</a>

      <!-- Mobile: Profile Settings and Purchases (only when authenticated) -->
      @if (isAuthenticated && isBrowser) {
        <a routerLink="/user-details" routerLinkActive="active" class="nav-item nav-link d-lg-none" (click)="closeMobileMenu()">פרופיל משתמש</a>
      }
      @if (isAuthenticated && isBrowser) {
        <a routerLink="/my-events" routerLinkActive="active" class="nav-item nav-link d-lg-none" (click)="closeMobileMenu()">אירועים שלי</a>
      }
      @if (isAuthenticated && isBrowser) {
        <a routerLink="/purchases" routerLinkActive="active" class="nav-item nav-link d-lg-none" (click)="closeMobileMenu()">רכישות</a>
      }
      @if (isAuthenticated && isAdminOrInstructor() && isBrowser) {
        <a routerLink="/admin/users" routerLinkActive="active" class="nav-item nav-link d-lg-none" (click)="closeMobileMenu()">ניהול משתמשים</a>
      }
      @if (isAuthenticated && isAdmin() && isBrowser) {
        <a routerLink="/admin/events" routerLinkActive="active" class="nav-item nav-link d-lg-none" (click)="closeMobileMenu()">ניהול אירועים</a>
      }
      @if (isAuthenticated && isAdminOrInstructor() && isBrowser) {
        <a href="#" class="nav-item nav-link d-lg-none" (click)="openRegisterNewUser(); closeMobileMenu(); $event.preventDefault()">רישום משתמש חדש</a>
      }

      <!-- Login Button (when not authenticated) -->
      @if (!isAuthenticated || !isBrowser) {
        <div class="nav-item nav-link-auth">
          <button
            type="button"
            class="btn-login"
            (click)="openLoginModal(); closeMobileMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="login-icon">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10 17 15 12 10 7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
            <span class="login-text">התחברות</span>
          </button>
        </div>
      }

      <!-- Desktop: User Menu (when authenticated) -->
      @if (isAuthenticated && isBrowser) {
        <div class="nav-item nav-link-auth d-none d-lg-flex">
          <app-user-menu></app-user-menu>
        </div>
      }

      <!-- Mobile: Logout Button (when authenticated) -->
      @if (isAuthenticated && isBrowser) {
        <div class="nav-item nav-link-auth d-lg-none">
          <button
            type="button"
            class="btn-login btn-logout"
            (click)="onLogout(); closeMobileMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="login-icon">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span class="login-text">התנתקות</span>
          </button>
        </div>
      }
    </div>
  </div>
</nav>
