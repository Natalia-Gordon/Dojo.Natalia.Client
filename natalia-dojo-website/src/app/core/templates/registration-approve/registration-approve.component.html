<section class="registration-approve" dir="rtl">
  <div class="registration-approve__hero">
    <div class="registration-approve__hero-overlay">
      <div class="registration-approve__hero-content">
        <h1 class="registration-approve__hero-title">פרטי תשלום</h1>
        <p class="registration-approve__hero-subtitle">
          בדף זה ניתן לצפות בפרטי הרשמה והתשלום של משתתף לאירוע. אם התשלום ממתין לאישור — ניתן לאשר או לדחות את התשלום ולהוסיף הערות.
        </p>
        <div class="registration-approve__hero-breadcrumbs">
          <a routerLink="/home">דף הבית</a>
          <span class="divider">/</span>
          <ng-container *ngIf="fromEventRegistrations && eventId != null">
            <a routerLink="/admin/events">ניהול אירועים</a>
            <span class="divider">/</span>
            <a [routerLink]="['/events', eventId, 'registrations']">נרשמו לאירוע</a>
            <span class="divider">/</span>
          </ng-container>
          <span class="current-page">פרטי תשלום</span>
        </div>
      </div>
    </div>
  </div>
  <div class="registration-approve__main">
    <div *ngIf="errorMessage" class="registration-approve__error">
      <i class="bi bi-exclamation-circle-fill" aria-hidden="true"></i>
      {{ errorMessage }}
    </div>
    <div *ngIf="message" class="registration-approve__message">
      <i class="bi bi-check-circle-fill" aria-hidden="true"></i>
      {{ message }}
    </div>
    <div *ngIf="!isAdminOrInstructor && !isLoading" class="registration-approve__restricted">
      אין לך הרשאה לאשר תשלום. התחבר כמנהל או מדריך האירוע.
    </div>
    <div *ngIf="isLoading" class="registration-approve__status">
      <span class="registration-approve__spinner" aria-hidden="true"></span>
      טוען פרטי הרשמה...
    </div>

    <div *ngIf="!isLoading && event && registration && isAdminOrInstructor" class="registration-approve__card">
      <!-- Event summary -->
      <div class="registration-approve__section registration-approve__section--event">
        <h2 class="registration-approve__section-title">
          <i class="bi bi-calendar-event" aria-hidden="true"></i>
          פרטי האירוע
        </h2>
        <h3 class="registration-approve__event-title">{{ event.title || 'אירוע #' + eventId }}</h3>
        <div class="registration-approve__event-meta">
          <span class="registration-approve__badge registration-approve__badge--type">{{ getEventTypeLabel(event.eventType) }}</span>
          <span class="registration-approve__meta-item">
            <i class="bi bi-calendar3" aria-hidden="true"></i>
            {{ getEventDateRange() }}
          </span>
          <span *ngIf="event.location" class="registration-approve__meta-item">
            <i class="bi bi-geo-alt" aria-hidden="true"></i>
            {{ event.location }}
          </span>
          <span class="registration-approve__meta-item registration-approve__price">
            <i class="bi bi-currency-exchange" aria-hidden="true"></i>
            {{ formatPrice(event.price) }}
            <span *ngIf="event.earlyBirdPrice != null && event.earlyBirdPrice !== event.price" class="registration-approve__early-bird">
              (מחיר מוקדם {{ formatPrice(event.earlyBirdPrice) }})
            </span>
          </span>
        </div>
      </div>

      <!-- Participant & registration -->
      <div class="registration-approve__section registration-approve__section--participant">
        <h2 class="registration-approve__section-title">
          <i class="bi bi-person-badge" aria-hidden="true"></i>
          פרטי המשתתף
        </h2>
        <dl class="registration-approve__dl">
          <dt>מזהה הרשמה</dt>
          <dd><span class="registration-approve__reg-id">#{{ registrationId }}</span></dd>
          <dt>משתמש</dt>
          <dd class="registration-approve__user">{{ getRegDisplayName() }}</dd>
          <dt *ngIf="registration.email">אימייל</dt>
          <dd *ngIf="registration.email">{{ registration.email }}</dd>
          <dt *ngIf="registration.phone">טלפון</dt>
          <dd *ngIf="registration.phone">{{ registration.phone }}</dd>
          <dt>תאריך הרשמה</dt>
          <dd>{{ formatDate(registration.registeredAt) }}</dd>
          <dt *ngIf="registration.notes">הערות מהמשתתף</dt>
          <dd *ngIf="registration.notes" class="registration-approve__notes-text">{{ registration.notes }}</dd>
        </dl>
      </div>

      <!-- Payment status -->
      <div class="registration-approve__section registration-approve__section--payment">
        <h2 class="registration-approve__section-title">
          <i class="bi bi-credit-card-2-front" aria-hidden="true"></i>
          סטטוס תשלום
        </h2>
        <div class="registration-approve__payment-row">
          <span class="registration-approve__badge registration-approve__badge--payment" [ngClass]="getPaymentStatusBadgeClass()">
            {{ getPaymentStatusLabel() }}
          </span>
        </div>
      </div>

      <!-- Approval actions (when pending) -->
      <div *ngIf="canApprove()" class="registration-approve__section registration-approve__section--actions">
        <h2 class="registration-approve__section-title">
          <i class="bi bi-pencil-square" aria-hidden="true"></i>
          אישור / דחייה
        </h2>
        <div class="registration-approve__notes-wrap">
          <label for="approvalNotes">הערות (אופציונלי)</label>
          <textarea id="approvalNotes" class="registration-approve__notes" [(ngModel)]="approvalNotes" rows="3" placeholder="הערות לאישור או לדחייה"></textarea>
        </div>
        <div class="registration-approve__actions">
          <button type="button" class="registration-approve__btn registration-approve__btn--approve" [disabled]="approveLoading || rejectLoading" (click)="approve()">
            <i class="bi bi-check-lg" aria-hidden="true"></i>
            {{ approveLoading ? 'מאשר...' : 'אשר תשלום' }}
          </button>
          <button type="button" class="registration-approve__btn registration-approve__btn--reject" [disabled]="rejectLoading || approveLoading" (click)="reject()">
            <i class="bi bi-x-lg" aria-hidden="true"></i>
            {{ rejectLoading ? 'דוחה...' : 'דחה תשלום' }}
          </button>
        </div>
      </div>

      <p *ngIf="!canApprove() && registration" class="registration-approve__no-action">
        <i class="bi bi-info-circle" aria-hidden="true"></i>
        ההרשמה אינה במצב ממתין לאישור תשלום.
      </p>
    </div>
  </div>
</section>
